{% extends "base.html" %}
{% block title %}Entry Verification - GOVVENS{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8 col-lg-6">
        <div class="card bg-dark text-white border-0 shadow-lg">
            <div class="card-header bg-success text-center">
                <h2 class="mb-0"><i class="bi bi-qr-code-scan me-2"></i>Entry Verification</h2>
                <small class="text-white-50">At Venue Gate</small>
            </div>
            <div class="card-body p-4">
                <div class="alert alert-warning mb-4">
                    <i class="bi bi-exclamation-triangle me-2"></i>
                    <strong>Venue Entry Point</strong><br>
                    This page is used at the stadium gate for entry verification via QR code or Face/Eye scan.
                </div>

                <div class="text-center mb-4">
                    <div class="mb-3">
                        <i class="bi bi-qr-code" style="font-size: 4rem; color: #198754;"></i>
                    </div>
                    <h4>Scan QR Code or Verify Face</h4>
                    <p class="text-muted">Present your ticket QR code or use face verification for entry.</p>
                </div>

                <!-- QR Code Scanner Section -->
                <div class="card bg-secondary mb-4" style="min-height: 250px;">
                    <div class="card-body d-flex align-items-center justify-content-center">
                        <div class="text-center">
                            <i class="bi bi-qr-code-scan" style="font-size: 3rem;"></i>
                            <p class="mt-3">QR Code Scanner</p>
                            <small class="text-muted">(In production, this would show live scanner feed)</small>
                        </div>
                    </div>
                </div>

                <!-- Manual QR Code Input (for testing) -->
                <form method="post" action="{% url 'entry_verification' %}" id="verificationForm">
                    {% csrf_token %}
                    <div class="mb-3">
                        <label for="qr_code" class="form-label">Or Enter QR Code Manually (for testing):</label>
                        <div class="input-group">
                            <span class="input-group-text bg-secondary text-white"><i class="bi bi-qr-code"></i></span>
                            <input type="text" class="form-control bg-dark text-white border-secondary" 
                                   id="qr_code" name="qr_code" placeholder="Enter QR code" 
                                   value="VALID_QR_CODE">
                        </div>
                        <small class="text-muted">For demo, use: <strong>VALID_QR_CODE</strong></small>
                    </div>

                    <div class="d-grid gap-2">
                        <button type="submit" class="btn btn-success btn-lg">
                            <i class="bi bi-check-circle me-2"></i>Verify Entry
                        </button>
                    </div>
                </form>

                <hr class="my-4 text-secondary">

                <!-- Face Verification Option -->
                <div class="card bg-secondary mb-3">
                    <div class="card-body">
                        <h6 class="text-white"><i class="bi bi-camera-video me-2"></i>Face Verification</h6>
                        <p class="small text-muted mb-2">Alternatively, use face recognition for quick entry.</p>
                        <button type="button" class="btn btn-outline-light btn-sm" onclick="alert('Face verification would be activated here in production')">
                            <i class="bi bi-camera-fill me-1"></i>Start Face Scan
                        </button>
                    </div>
                </div>

                <div class="text-center">
                    <p class="small text-muted mb-0">
                        <i class="bi bi-info-circle me-1"></i>
                        Verification status will be displayed after scanning.
                    </p>
                </div>
            </div>
        </div>

        <div class="card bg-dark text-white border-0 shadow mt-3">
            <div class="card-body">
                <h6 class="text-success"><i class="bi bi-shield-check me-2"></i>Entry Process</h6>
                <ul class="small text-muted mb-0">
                    <li>Scan your ticket QR code or use face verification</li>
                    <li>System validates ticket and checks entry time slot</li>
                    <li>Entry granted if verification is successful</li>
                    <li>Follow staff instructions for crowd management</li>
                </ul>
            </div>
        </div>
    </div>
</div>

<script>
    // Handle form submission with AJAX for better UX
    document.getElementById('verificationForm').addEventListener('submit', function(e) {
        e.preventDefault();
        const formData = new FormData(this);
        
        fetch(this.action, {
            method: 'POST',
            body: formData,
            headers: {
                'X-CSRFToken': formData.get('csrfmiddlewaretoken')
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                alert('✓ Entry granted! ' + data.message);
            } else {
                alert('✗ Entry denied. ' + data.message);
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('An error occurred. Please try again.');
        });
    });
</script>
{% endblock %}

