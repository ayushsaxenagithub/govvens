{% extends "base.html" %}
{% block title %}Select Seats - {{ event.name }}{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2 class="mb-0"><i class="bi bi-cursor me-2"></i>Select Your Seats for {{ event.name }}</h2>
    <div class="text-muted">
        <i class="bi bi-currency-rupee me-1"></i>{{ event.ticket_price }} per seat
    </div>
</div>
<div class="alert alert-info mb-4">
    <h6 class="alert-heading"><i class="bi bi-info-circle me-2"></i>Seat Selection Guide</h6>
    <ul class="mb-0 small">
        <li>Choose your preferred seats from the interactive map below</li>
        <li>Selected seats will be held for <strong>15 minutes</strong> during checkout</li>
        <li>Multiple seats can be selected for group bookings</li>
        <li>Seat prices are displayed per seat</li>
        <li>After selection, proceed to payment to confirm your booking</li>
    </ul>
</div>

{% if not user.is_authenticated %}
<div class="alert alert-warning mb-4">
    <i class="bi bi-exclamation-triangle me-2"></i>
    <strong>Login Required:</strong> You can browse seats, but you'll need to <a href="{% url 'signup_login' %}" class="alert-link">login</a> to complete your booking.
</div>
{% elif not user.is_verified %}
<div class="alert alert-warning mb-4">
    <i class="bi bi-shield-exclamation me-2"></i>
    <strong>Identity Verification Required:</strong> Please <a href="{% url 'verify_identity' %}" class="alert-link">verify your identity</a> to complete booking.
</div>
{% endif %}

<div class="card bg-dark text-white border-0 shadow mb-4">
    <div class="card-body">
        <div class="border p-3 bg-dark">
            <div class="row g-2">
                <div class="col-md-6">
                    <h5>Block A</h5>
                    <div class="row g-1">
                        <div class="col-12">
                            <div class="btn-group" role="group">
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-1-1" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-1-1">1-1</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-1-2" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-1-2">1-2</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-1-3" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-1-3">1-3</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-1-4" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-1-4">1-4</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="btn-group" role="group">
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-2-1" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-2-1">2-1</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-2-2" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-2-2">2-2</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-2-3" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-2-3">2-3</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-2-4" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-2-4">2-4</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="btn-group" role="group">
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-3-1" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-3-1">3-1</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-3-2" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-3-2">3-2</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-3-3" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-3-3">3-3</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-A-3-4" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-A-3-4">3-4</label>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <h5>Block B</h5>
                    <div class="row g-1">
                        <div class="col-12">
                            <div class="btn-group" role="group">
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-1-1" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-1-1">1-1</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-1-2" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-1-2">1-2</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-1-3" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-1-3">1-3</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-1-4" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-1-4">1-4</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="btn-group" role="group">
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-2-1" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-2-1">2-1</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-2-2" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-2-2">2-2</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-2-3" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-2-3">2-3</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-2-4" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-2-4">2-4</label>
                            </div>
                        </div>
                        <div class="col-12">
                            <div class="btn-group" role="group">
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-3-1" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-3-1">3-1</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-3-2" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-3-2">3-2</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-3-3" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-3-3">3-3</label>
                                <input type="checkbox" class="btn-check" name="selected_seats" id="seat-B-3-4" autocomplete="off">
                                <label class="btn btn-outline-light btn-sm" for="seat-B-3-4">3-4</label>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<form method="post" action="{% url 'seat_selection' event.id %}">
    {% csrf_token %}
    <div id="selectedSeatsInfo" class="alert alert-info mb-3" style="display: none;">
        <i class="bi bi-info-circle me-2"></i>
        <strong>Selected Seats:</strong> <span id="selectedSeatsList"></span>
        <br><strong>Total Price:</strong> â‚¹<span id="totalPrice">0</span>
    </div>
    <div class="d-flex gap-2">
        <button type="submit" class="btn btn-primary btn-lg" id="proceedBtn" disabled>
            <i class="bi bi-arrow-right-circle me-2"></i>Proceed to Payment
        </button>
        <a href="{% url 'event_detail' event.id %}" class="btn btn-secondary btn-lg">
            <i class="bi bi-arrow-left me-2"></i>Back
        </a>
    </div>
</form>

<script>
    const ticketPrice = {{ event.ticket_price }};
    const selectedSeatsList = document.getElementById('selectedSeatsList');
    const totalPriceSpan = document.getElementById('totalPrice');
    const selectedSeatsInfo = document.getElementById('selectedSeatsInfo');
    const proceedBtn = document.getElementById('proceedBtn');
    
    function updateSelection() {
        const selected = document.querySelectorAll('input[name="selected_seats"]:checked');
        const selectedSeats = Array.from(selected).map(cb => cb.id.replace('seat-', ''));
        const totalPrice = selected.length * ticketPrice;
        
        if (selected.length > 0) {
            selectedSeatsList.textContent = selectedSeats.join(', ');
            totalPriceSpan.textContent = totalPrice.toLocaleString('en-IN');
            selectedSeatsInfo.style.display = 'block';
            proceedBtn.disabled = false;
        } else {
            selectedSeatsInfo.style.display = 'none';
            proceedBtn.disabled = true;
        }
    }
    
    document.querySelectorAll('input[name="selected_seats"]').forEach(el => {
        el.addEventListener('change', updateSelection);
    });
</script>

<!-- Seat Selection FAQ Section -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card bg-secondary text-white border-0 shadow">
            <div class="card-header bg-warning text-dark">
                <h4 class="mb-0"><i class="bi bi-question-circle me-2"></i>Seat Selection FAQs</h4>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <h6 class="text-warning"><i class="bi bi-people-fill me-2"></i>Can I book seats for my friends or family?</h6>
                        <p class="small mb-0">Yes. The seat map supports individual, friends, and family bookings. You can select multiple seats together, and they will be held for up to 15 minutes during checkout. Each person will need their own identity verification for entry at the venue.</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-warning"><i class="bi bi-clock me-2"></i>How long are seats reserved?</h6>
                        <p class="small mb-0">Selected seats are held for 15 minutes during the checkout process. If payment isn't completed within this time, the seats will be released and made available to other users. You'll see a countdown timer during checkout.</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-warning"><i class="bi bi-cursor me-2"></i>How do I select seats?</h6>
                        <p class="small mb-0">Click on available seats from the interactive seat map. Selected seats will be highlighted. You can select multiple seats for group bookings. The total price will be calculated automatically based on the number of seats selected.</p>
                    </div>
                    <div class="col-md-6">
                        <h6 class="text-warning"><i class="bi bi-shield-check me-2"></i>Do I need verification to select seats?</h6>
                        <p class="small mb-0">You can browse and select seats without verification, but you'll need to verify your identity before completing the booking. Identity verification ensures secure entry at the venue and prevents ticket fraud.</p>
                    </div>
                </div>
                <div class="text-center mt-3">
                    <a href="{% url 'faq' %}" class="btn btn-outline-light">
                        <i class="bi bi-question-circle me-2"></i>View All FAQs
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}